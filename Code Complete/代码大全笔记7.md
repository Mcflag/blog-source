title: 代码大全笔记7
date: 2015-06-30 16:14:42
tags: [代码大全]
---

##摘要
防御式编程，核心思想是子程序应该不因传入错误的数据而被破坏，哪怕是由其他子程序产生的错误数据。

<!--more-->

##保护程序免遭非法输入数据的破坏

通常有三种方法处理进来非法数据的问题

* 检查所有来源于外部的数据的值
* 检查子程序所有输入参数的值
* 决定如何处理错误的输入数据

##错误处理技术

* 返回中立值：比如返回默认值0或者空字符串。
* 换用下一个正确的数据。
* 返回与前次相同的数据。
* 换用最接近的合法值。
* 把警告信息记录到日志文件中。
* 返回一次错误码。
* 调用错误处理子程序或对象。
* 当错误发生时显示出错消息。
* 用最妥当的方式在局部处理错误。
* 关闭程序。

##正确性和健壮性

正确性意味着永不返回不准确的结果，哪怕不返回结果也比返回不准确的结果好。健壮性意味着要不断尝试采取某些措施，以保证软件可以持续地运转下去，哪怕有时做出一些不够准确的结果。

##异常

* 用异常通知程序的其他部分，发生了不可忽略的错误
* 只有真正例外的情况下才抛出异常
* 不能用异常来推卸责任
* 避免在构造函数和析构函数中抛出异常，除非你在同一地方把它们捕获
* 在恰当的抽象层次抛出异常
* 在异常消息中加入关于导致异常发生的全部信息
* 避免使用空的catch语句
* 了解所用函数库可能抛出的异常
* 考虑创建一个集中的异常报告机制
* 把项目中对异常的使用标准化
* 考虑异常的替换方案

##确定在产品代码中该保留多少防御式代码

* 保留那些检查重要错误的代码
* 去掉检查细微错误的代码
* 去掉可以导致程序硬性崩溃的代码
* 保留可以让程序稳妥地崩溃的代码
* 为你的技术支持人员记录的错误信息
* 确认留在代码中的错误消息是友好的

##要点

* 最终产品代码中对错误的处理方式要要比“垃圾进，垃圾出”复杂得多。
* 防御式编程技术可以让错误更容易发现，更容易修改，并减少错误对产品代码的破坏。
* 断言可以帮助人尽早发现错误，尤其是在大型系统和高可靠性的系统中，以及快速变化的代码中。
* 关于如何处理错误输入的决策是一项关键的错误处理决策，也是一项关键的高层设计决策。
* 异常提供了一种与代码正常的流程角度不同的错误处理手段，如果留心使用异常，它可以成为程序员们只是工具箱中的一项有益补充，同时应该在异常和其他错误处理手段之间进行权衡比较。
* 针对产品代码的限制并不适用于开发中的软件，你可以利用这一优势在开发中添加有助于更快地排查错误的代码。
